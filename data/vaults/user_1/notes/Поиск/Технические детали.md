---
title: Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
tags: [Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ, Ğ¿Ğ¾Ğ¸ÑĞº, Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ]
created: 2025-10-25
---

# Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°

Ğ”Ğ»Ñ Ñ‚ĞµÑ…, ĞºÑ‚Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ, ĞºĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ´ ĞºĞ°Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼.

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ”Ğ²ÑƒÑ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ°Ñ€ÑĞµÑ€ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²                    â”‚
â”‚  (Query Parser)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²               â”‚
â”‚  (Query Planner)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¡Ğ»Ğ¾Ğ¹ A     â”‚ â”‚  Ğ¡Ğ»Ğ¾Ğ¹ B     â”‚
â”‚ (Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)  â”‚ â”‚ (Ğ¡ĞµÑ€Ğ²ĞµÑ€)    â”‚
â”‚             â”‚ â”‚             â”‚
â”‚ IndexedDB   â”‚ â”‚ Whoosh      â”‚
â”‚ < 50ms      â”‚ â”‚ < 200ms     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¤ĞµĞ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€                          â”‚
â”‚  (Federation)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
```

### Ğ¡Ğ»Ğ¾Ğ¹ A - Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ (IndexedDB)

**Ğ§Ñ‚Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ:**
- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ¿ÑƒÑ‚ÑŒ, Ğ¸Ğ¼Ñ, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€, mtime, hash)
- Ğ¢ĞµĞ³Ğ¸ (Ñ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸ĞµĞ¹)
- Ğ¡Ğ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° (frontmatter)
- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸ (H1-H6)
- Ğ¡ÑÑ‹Ğ»ĞºĞ¸ (wikilinks Ğ¸ markdown)
- ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸
- Ğ‘Ğ»Ğ¾ĞºĞ¸ (^block-id)
- Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ (- [ ] / - [x])

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° IndexedDB:**
```javascript
{
  files: 'path, mtime, size, hash, name',
  meta: 'path, *tags, *headingTexts, *linkPaths',
  tagIndex: '[tag+path], tag, path',
  propIndex: '[key+value+path], key, value, path',
  linkIndex: '[dstPath+srcPath], dstPath, srcPath',
  blocks: '[path+blockId], path, blockId',
  tasks: '[path+line], path, done'
}
```

**ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ (O-Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ):**
- `pathsByTag(tag)` â†’ O(1) - Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿
- `pathsByProp(key, value)` â†’ O(1)
- `pathsByFile(name)` â†’ O(n) - ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ
- Boolean algebra (AND/OR/NOT) â†’ O(k), k = Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ°

### Ğ¡Ğ»Ğ¾Ğ¹ B - Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ñ‹Ğ¹ (Whoosh)

**Ğ¡Ñ…ĞµĞ¼Ğ° Whoosh:**
```python
{
    'path': ID(stored=True, unique=True),
    'name': TEXT(field_boost=2.0),
    'tags': KEYWORD(commas=True),
    'props': KEYWORD(commas=True),
    'content': TEXT(analyzer=StemmingAnalyzer),
    'tri': NGRAM(minsize=3, maxsize=3),  # Ğ´Ğ»Ñ regex
    'mtime': DATETIME(),
    'size': NUMERIC()
}
```

**Scoring:** BM25F (Ğ»ÑƒÑ‡ÑˆĞµ Ñ‡ĞµĞ¼ TF-IDF)

**ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
- AsyncWriter Ğ´Ğ»Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸
- Trigram prefiltering Ğ´Ğ»Ñ regex
- Path filtering Ñ‡ĞµÑ€ĞµĞ· Whoosh filter (Ğ½Ğµ post-processing)

## âš¡ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¸

| ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ | Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ | Ğ¡ĞµÑ€Ğ²ĞµÑ€ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ |
|----------|----------|--------|------------|
| Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ 1000 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² | 1 ÑĞµĞº | 2 ÑĞµĞº | Ğ‘Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³ |
| ĞŸĞ¾Ğ¸ÑĞº `tag:work` | < 10ms | N/A | IndexedDB |
| ĞŸĞ¾Ğ¸ÑĞº `"Ñ„Ñ€Ğ°Ğ·Ğ°"` | N/A | < 100ms | Whoosh |
| ĞšĞ¾Ğ¼Ğ±Ğ¾ `tag:work "Ñ„Ñ€Ğ°Ğ·Ğ°"` | < 150ms | - | Ğ¤ĞµĞ´ĞµÑ€Ğ°Ñ†Ğ¸Ñ |

### Ğ Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²

| ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² | IndexedDB | Whoosh | Ğ’ÑĞµĞ³Ğ¾ |
|-------------------|-----------|--------|-------|
| 100 | 0.5 MB | 5 MB | 5.5 MB |
| 1,000 | 3 MB | 30 MB | 33 MB |
| 10,000 | 25 MB | 250 MB | 275 MB |

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ hash:**
```typescript
const hash = hashContent(content);
if (existingFile.hash === hash) {
  return; // ĞĞµ Ğ¿ĞµÑ€ĞµĞ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€ÑƒĞµĞ¼
}
```

**2. Ğ‘Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³:**
```typescript
const BATCH_SIZE = 50;
while (queue.length > 0) {
  const batch = queue.splice(0, BATCH_SIZE);
  await indexBatch(batch);
  await yield(); // ĞÑ‚Ğ´Ğ°ĞµĞ¼ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ UI
}
```

**3. Web Worker:**
```typescript
// ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ² Ñ„Ğ¾Ğ½Ğµ, Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ UI
worker.postMessage({ type: 'INDEX_FILE', payload: {...} });
```

**4. ĞŸÑ€ĞµÑ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ:**
```python
# Regex Ñ Ñ‚Ñ€Ğ¸Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ğ¼Ğ¸
if pattern.startswith('TODO'):
    tri_query = Term("tri", "TOD")
    clauses.append(tri_query)
```

## ğŸ§© ĞŸĞ°Ñ€ÑĞµÑ€ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

### Ğ“Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ° (EBNF-Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ğ°Ñ)

```
query       = or_expr
or_expr     = and_expr ("OR" and_expr)*
and_expr    = not_expr not_expr*
not_expr    = "-" primary | primary
primary     = "(" or_expr ")" | term

term        = phrase | regex | property | prefix_op | word
phrase      = '"' .* '"'
regex       = '/' .* '/' [flags]
property    = '[' key op value ']'
prefix_op   = prefix ':' value

prefix      = "tag" | "file" | "path" | "block" | "section" 
            | "link" | "backlink" | "task" | "line"
op          = ':' | '=' | '!=' | '>' | '>=' | '<' | '<='
```

### AST (Abstract Syntax Tree)

```typescript
type Expr = 
  | { kind: 'and'; children: Expr[] }
  | { kind: 'or'; children: Expr[] }
  | { kind: 'not'; child: Expr }
  | Term

type Term = 
  | { kind: 'word'; value: string }
  | { kind: 'phrase'; value: string }
  | { kind: 'tag'; value: string }
  | { kind: 'prop'; key: string; op: string; value: any }
  // ... Ğ¸ Ñ‚.Ğ´.
```

### ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‚ĞµÑ€Ğ¼Ğ¾Ğ²:**
```typescript
function classifyTerm(term: Term): 'local' | 'server' | 'hybrid' {
  switch (term.kind) {
    case 'tag':
    case 'file':
    case 'path':
    case 'prop':
    case 'block':
    case 'section':
    case 'link':
    case 'backlink':
    case 'task':
      return 'local';
    
    case 'word':
    case 'phrase':
    case 'regex':
      return 'server';
    
    case 'line':
      return 'hybrid';
  }
}
```

**Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑĞ»Ğ¾Ğ¸:**
```typescript
// tag:work "important" 
// â†“
// Local: tag:work
// Server: "important"
// Execution: filter by tag, then search in filtered files
```

## ğŸ”„ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸

### Frontend (IndexedDB)

1. **Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°:**
```typescript
await api.saveFile(path, content);
```

2. **PostMessage Ğ² Worker:**
```typescript
worker.postMessage({
  type: 'INDEX_FILE',
  payload: { path, content, mtime, hash }
});
```

3. **ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ² Worker:**
```typescript
const meta = parseMarkdown(path, content);
// Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚: tags, props, headings, links, blocks, tasks
```

4. **Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² IndexedDB:**
```typescript
await db.transaction('rw', [...tables], async () => {
  // ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²ÑĞµ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
});
```

### Backend (Whoosh)

1. **Webhook Ğ¾Ñ‚ frontend (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾):**
```http
POST /api/search/index
{
  "path": "notes/work.md",
  "content": "...",
  "name": "work.md",
  "tags": ["work"],
  "props": {"status": "active"}
}
```

2. **Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ:**
```python
writer = AsyncWriter(ix)
writer.update_document(
    path=path,
    content=content,
    tags=",".join(tags),
    # ...
)
writer.commit()
```

## ğŸ” ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ğ¾Ğ¸ÑĞºĞ°

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: `tag:work "important"`

**1. ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³:**
```typescript
const ast = parseQuery('tag:work "important"');
// {
//   kind: 'and',
//   children: [
//     { kind: 'tag', value: 'work' },
//     { kind: 'phrase', value: 'important' }
//   ]
// }
```

**2. ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
```typescript
const plan = planQuery(ast);
// {
//   local: { kind: 'tag', value: 'work' },
//   server: { kind: 'phrase', value: 'important' },
//   explanation: 'Query uses both local filters and server search'
// }
```

**3. Ğ˜ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸:**
```typescript
const paths = await executeLocal(plan.local);
// Set<string> Ñ Ğ¿ÑƒÑ‚ÑĞ¼Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ Ñ‚ĞµĞ³Ğ¾Ğ¼ work
```

**4. Ğ˜ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ğ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸:**
```typescript
const serverReq = {
  terms: [{ type: 'phrase', value: 'important' }],
  restrict_paths: Array.from(paths)
};
const serverResp = await fetch('/api/search', { body: serverReq });
```

**5. ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²:**
```typescript
const hits = mergeHits(localHits, serverResp.hits);
```

## ğŸ› ï¸ API Reference

### Frontend

```typescript
// ĞŸĞ¾Ğ¸ÑĞº
import { searchEngine } from '@/search/engine';

const result = await searchEngine.search(
  'tag:work "important"',
  { limit: 50, sort: 'mtime' }
);

// Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ
await searchEngine.indexLocal({
  path: 'notes/work.md',
  content: '# Work\n...',
  mtime: Date.now(),
  hash: ''
});

// Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
const stats = await searchEngine.getStats();
// { files: 1234, tags: 567, links: 890, ... }
```

### Backend

```python
from app.search import get_indexer

# Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ
indexer = get_indexer()
indexer.upsert_document(
    path='notes/work.md',
    content='# Work\n...',
    name='work.md',
    tags=['work', 'important'],
    props={'status': 'active'}
)

# ĞŸĞ¾Ğ¸ÑĞº (Ñ‡ĞµÑ€ĞµĞ· HTTP API)
POST /api/search
{
  "terms": [{"type": "word", "value": "important"}],
  "restrict_paths": ["notes/work.md"],
  "limit": 50
}
```

## ğŸ” Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

```python
# app/search/api.py
@router.post("/search")
async def search(
    req: SearchRequest,
    current_user: User = Depends(get_current_user)
):
    # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹
    user_vault = get_vault_path(current_user.id)
    # ...
```

### Path validation

```python
def validate_path(path: str, user_vault: str) -> bool:
    real_path = os.path.realpath(os.path.join(user_vault, path))
    return real_path.startswith(user_vault)
```

### Rate limiting (TODO)

```python
from slowapi import Limiter

limiter = Limiter(key_func=get_remote_address)

@app.post("/search")
@limiter.limit("100/minute")
async def search(...):
    ...
```

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

- [Whoosh Documentation](https://whoosh.readthedocs.io/)
- [IndexedDB API](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [Dexie.js](https://dexie.org/)
- [BM25 Algorithm](https://en.wikipedia.org/wiki/Okapi_BM25)

---

Ğ¡Ğ¼. Ñ‚Ğ°ĞºĞ¶Ğµ:
- [[Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº]]
- [[ĞĞ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°]]
- [[ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²]]

