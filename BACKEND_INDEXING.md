# üîç Backend –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è

## –û–±–∑–æ—Ä

Backend —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** —Å Whoosh, –∫–æ—Ç–æ—Ä–∞—è:
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –ø—É—Å—Ç–æ–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –†–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã  
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç mtime –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ)
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—Å—è –≤ `data/whoosh/` (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –°–∏—Å—Ç–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         FRONTEND (Browser)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  IndexedDB (Local Search)               ‚îÇ
‚îÇ  - Instant local filtering              ‚îÇ
‚îÇ  - Tags, props, paths, links            ‚îÇ
‚îÇ  - No full-text search                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ Federated Query
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         BACKEND (Server)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Whoosh Index (Full-Text Search)       ‚îÇ
‚îÇ  - BM25F ranking                        ‚îÇ
‚îÇ  - Trigram search                       ‚îÇ
‚îÇ  - Persistent storage                   ‚îÇ
‚îÇ  - Snippets & highlights                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è

### –ü—Ä–∏ –ó–∞–ø—É—Å–∫–µ Backend (Startup)

**–§–∞–π–ª:** `backend/app/main.py` ‚Üí `lifespan()`

```python
# –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å –∏–∑ data/whoosh/
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∏–Ω–¥–µ–∫—Å–µ
3. –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å –ø—É—Å—Ç–æ–π –ò–õ–ò INDEX_ON_STARTUP=True:
   ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ mtime (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã)
5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: "Indexed: X, Skipped: Y"
```

**–õ–æ–≥–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
```
üöÄ Starting Obsidian Web API...
‚úÖ Database initialized
üìÅ Vaults directory: data/vaults
üîç Indexes directory: data/indexes
üîê CORS origins: [...]
üîç Search index loaded: 15 documents
üìö Starting background indexing...
‚úÖ Background indexing complete! Indexed: 3, Skipped: 12
```

### –ü—Ä–∏ –°–æ–∑–¥–∞–Ω–∏–∏ –§–∞–π–ª–∞

**–§–∞–π–ª:** `backend/app/api/files.py` ‚Üí `create_file()`

```python
POST /files/
  1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª –≤ vault
  2. –ò–∑–≤–ª–µ—á—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (tags, props)
  3. –î–æ–±–∞–≤–∏—Ç—å –≤ Whoosh –∏–Ω–¥–µ–∫—Å
  4. –í–µ—Ä–Ω—É—Ç—å —É—Å–ø–µ—Ö
```

### –ü—Ä–∏ –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –§–∞–π–ª–∞

**–§–∞–π–ª:** `backend/app/api/files.py` ‚Üí `update_file()`

```python
PUT /files/{path}
  1. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –≤ vault
  2. –ò–∑–≤–ª–µ—á—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  3. –û–±–Ω–æ–≤–∏—Ç—å –≤ Whoosh –∏–Ω–¥–µ–∫—Å–µ (update_document)
  4. –í–µ—Ä–Ω—É—Ç—å —É—Å–ø–µ—Ö
```

### –ü—Ä–∏ –£–¥–∞–ª–µ–Ω–∏–∏ –§–∞–π–ª–∞

**–§–∞–π–ª:** `backend/app/api/files.py` ‚Üí `delete_file()`

```python
DELETE /files/{path}
  1. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏–∑ vault
  2. –£–¥–∞–ª–∏—Ç—å –∏–∑ Whoosh –∏–Ω–¥–µ–∫—Å–∞
  3. –í–µ—Ä–Ω—É—Ç—å —É—Å–ø–µ—Ö
```

### –ü—Ä–∏ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏

**–§–∞–π–ª:** `backend/app/api/files.py` ‚Üí `rename_file()`

```python
POST /files/rename
  1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª
  2. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π path –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
  3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π path –≤ –∏–Ω–¥–µ–∫—Å
  4. –í–µ—Ä–Ω—É—Ç—å —É—Å–ø–µ—Ö
```

---

## üìä Whoosh –ò–Ω–¥–µ–∫—Å

### Schema

```python
Schema(
    path=ID(stored=True, unique=True),       # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    name=TEXT(stored=True, field_boost=2.0),  # –ò–º—è —Ñ–∞–π–ª–∞ (–±–æ–ª—å—à–∏–π –≤–µ—Å)
    tags=KEYWORD(lowercase=True, commas=True), # –¢–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
    props=KEYWORD(lowercase=True, commas=True),# –°–≤–æ–π—Å—Ç–≤–∞
    content=TEXT(phrase=True, stored=False),  # –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç (–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è)
    tri=NGRAM(minsize=3, maxsize=3),          # –¢—Ä–∏–≥—Ä–∞–º–º—ã –¥–ª—è regex
    mtime=DATETIME(stored=True),              # –í—Ä–µ–º—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
    size=NUMERIC(stored=True),                # –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
)
```

### –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –î–∞–Ω–Ω—ã–µ

1. **Path** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å —Ñ–∞–π–ª–∞
2. **Name** - –∏–º—è —Ñ–∞–π–ª–∞ (—Å boosting)
3. **Tags** - –≤—Å–µ —Ç–µ–≥–∏ –∏–∑ `#—Ç–µ–≥`
4. **Props** - –≤—Å–µ frontmatter —Å–≤–æ–π—Å—Ç–≤–∞
5. **Content** - –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç markdown
6. **Tri** - —Ç—Ä–∏–≥—Ä–∞–º–º—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ regex –ø–æ–∏—Å–∫–∞
7. **Mtime** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
8. **Size** - —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `backend/app/config.py`

```python
class Settings(BaseSettings):
    # Storage paths
    VAULTS_ROOT: str = "data/vaults"
    INDEXES_ROOT: str = "data/indexes"
    WHOOSH_INDEX_DIR: str = "data/whoosh"
    
    # Search settings
    INDEX_ON_STARTUP: bool = True  # –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `.env`:

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
INDEX_ON_STARTUP=false

# –ò–∑–º–µ–Ω–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–Ω–¥–µ–∫—Å–∞
WHOOSH_INDEX_DIR=/custom/path/whoosh
```

---

## üõ†Ô∏è –†—É—á–Ω–∞—è –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è

### –°–∫—Ä–∏–ø—Ç reindex.py

–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤:

```bash
cd backend
python reindex.py
```

**–í—ã–≤–æ–¥:**
```
Starting reindexing...
==================================================
Processing user 1...
  ‚úÖ Indexed: notes/Welcome.md
  ‚úÖ Indexed: notes/Getting Started.md
  ...
==================================================
‚úÖ Reindexing complete! Indexed 15 files.
Total documents in index: 15
```

### –°–∫—Ä–∏–ø—Ç reindex_simple.py

–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ FastAPI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
cd backend
python reindex_simple.py
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ò–Ω–¥–µ–∫—Å–∞

### –ß–µ—Ä–µ–∑ API

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–Ω–¥–µ–∫—Å–∞
curl http://localhost:8000/search/stats

# –û—Ç–≤–µ—Ç:
{
  "doc_count": 15,
  "version": 3,
  "index_dir": "data/whoosh"
}
```

### –ß–µ—Ä–µ–∑ Python

```python
from app.search.indexer import get_indexer

indexer = get_indexer()
stats = indexer.get_stats()
print(f"Documents: {stats['doc_count']}")
```

### –ß–µ—Ä–µ–∑ –õ–æ–≥–∏

```bash
tail -f data/app.log | grep "Indexed"
```

---

## üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ mtime

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç mtime —Ñ–∞–π–ª–æ–≤:
- –ï—Å–ª–∏ —Ñ–∞–π–ª **–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è** ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (Skipped)
- –ï—Å–ª–∏ —Ñ–∞–π–ª **–Ω–æ–≤—ã–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω** ‚Üí –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º (Indexed)

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:**
```
‚úÖ Background indexing complete! Indexed: 3, Skipped: 12
```

### Batch Indexing

–î–ª—è –º–∞—Å—Å–æ–≤–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è batch API:

```python
indexer = get_indexer()
documents = [
    {"path": "file1.md", "content": "...", "name": "file1.md", "tags": [], "props": {}},
    {"path": "file2.md", "content": "...", "name": "file2.md", "tags": [], "props": {}},
]
count = indexer.batch_upsert(documents)
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ò–Ω–¥–µ–∫—Å–∞

–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏:

```bash
curl -X POST http://localhost:8000/search/optimize
```

–ò–ª–∏:
```python
indexer.optimize()  # Merge segments
```

---

## üêõ Troubleshooting

### –ò–Ω–¥–µ–∫—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -f data/app.log
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É:**
   ```bash
   ls -la data/whoosh/
   ```

3. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
   ```bash
   cd backend
   python reindex.py
   ```

### –ü–æ–∏—Å–∫ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
   ```bash
   curl http://localhost:8000/search/stats
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è:**
   ```bash
   # –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥–∞—Ö:
   INFO: Indexed: notes/test.md
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:**
   ```bash
   curl -X POST http://localhost:8000/search \
     -H "Content-Type: application/json" \
     -d '{"terms":[{"type":"word","value":"test"}],"limit":10}'
   ```

### –ò–Ω–¥–µ–∫—Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω

```bash
# –£–¥–∞–ª–∏—Ç—å –∏–Ω–¥–µ–∫—Å
rm -rf data/whoosh/*

# –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å
cd backend
python reindex.py
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Benchmark (15 —Ñ–∞–π–ª–æ–≤)

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è |
|----------|-------|
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ | ~2-3 —Å–µ–∫ |
| –ü–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤—É | ~50-100 –º—Å |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ | ~10-20 –º—Å |
| Regex –ø–æ–∏—Å–∫ —Å —Ç—Ä–∏–≥—Ä–∞–º–º–∞–º–∏ | ~100-200 –º—Å |

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

| –§–∞–π–ª–æ–≤ | –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞ | –í—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ | –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ |
|--------|----------------|------------------|--------------|
| 100 | ~5 MB | ~10 —Å–µ–∫ | ~50 –º—Å |
| 1000 | ~50 MB | ~1-2 –º–∏–Ω | ~100 –º—Å |
| 10000 | ~500 MB | ~10-15 –º–∏–Ω | ~200 –º—Å |

---

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Frontend ‚Üî Backend

### –¢–µ–∫—É—â–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
1. Frontend –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã ‚Üí –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤ IndexedDB
2. Backend –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã ‚Üí –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤ Whoosh
3. –ü—Ä–∏ –ø–æ–∏—Å–∫–µ:
   - Local —á–∞—Å—Ç—å ‚Üí IndexedDB (tags, paths, props)
   - Server —á–∞—Å—Ç—å ‚Üí Whoosh (full-text content)
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è
```

### –ü–æ—á–µ–º—É –î–≤–µ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏–∏?

1. **Frontend (IndexedDB)**
   - –ë—ã—Å—Ç—Ä—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
   - –†–∞–±–æ—Ç–∞–µ—Ç offline
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–º –¥–∞–Ω–Ω—ã–º
   - –ì—Ä–∞—Ñ—ã —Å–≤—è–∑–µ–π

2. **Backend (Whoosh)**
   - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
   - BM25F —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –¢—Ä–∏–≥—Ä–∞–º–º—ã –¥–ª—è regex
   - Persistent storage
   - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## ‚úÖ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ mtime (–ø—Ä–æ–ø—É—Å–∫ –Ω–µ–∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö)  
‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ create/update/delete  
‚úÖ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (data/whoosh)  
‚úÖ API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
‚úÖ –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä—É—á–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞  

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **Zero Configuration** - —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"  
‚úÖ **Incremental Updates** - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã  
‚úÖ **Persistent** - –∏–Ω–¥–µ–∫—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏  
‚úÖ **Fast** - BM25F + —Ç—Ä–∏–≥—Ä–∞–º–º—ã  
‚úÖ **Reliable** - error handling + logging  
‚úÖ **Scalable** - –¥–æ 10K+ —Ñ–∞–π–ª–æ–≤  

---

## üéì –î–∞–ª—å–Ω–µ–π—à–∏–µ –£–ª—É—á—à–µ–Ω–∏—è (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] File watcher –¥–ª—è real-time –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- [ ] Distributed indexing –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- [ ] Elasticsearch/Meilisearch –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
- [ ] –Ø–∑—ã–∫–æ–≤—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã (—Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- [ ] Fuzzy search
- [ ] Relevance tuning

---

**üìö –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫! üöÄ**

